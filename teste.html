<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Trabalho 1</title>
		<style> 
			/*definicao estilo do canvas*/
			canvas {
				border: 1px solid black;
				position: absolute;
				top: 0; bottom: 0;
				left: 0; right: 0;
				margin: auto;
				background: #a0a0a0;
			}
			/*definicao estilo do body*/
			body{ 
				width: 500px;
				margin: right;
			} 
		</style>
	</head>
	<body>   
		<!--USO DO CANVAS NA PAGINA HTML-->
		<canvas width="1000" height="545" id="canvas" tabindex="0"> 
		Seu navegador n√£o tem suporte ao canvas!
		Atualize seu navegador.
	</canvas>

	<!--CODIGO JAVASCRIPT-->
	<script>
		/*VARIAVEIS UTILIZADAS*/
		var tela = document.getElementById("canvas");
		var ctx  = tela.getContext("2d"); 
		var fps = 30;
		var dt = 1/fps;  
		var tiros = [];  
		var boss = new SpriteBoss();  
		var imgBoss = new Image(); 
		imgBoss.src = "Img/Boss3.png";
		//imagem de https://www.google.com.br/url?sa=i&rct=j&q=&esrc=s&source=images&cd=&ved=0ahUKEwi2ucSD9OnMAhUMH5AKHT5qCnkQjxwIAw&url=http%3A%2F%2Fmillionthvector.blogspot.com%2Fp%2Ffree-sprites.html&bvm=bv.122448493,d.Y2I&psig=AFQjCNEc9R1233F176nHUlU1WD7Kb56DRg&ust=1463876732182239 
		var tiroB = new Image();
		tiroB.src = "Img/tiro2.png"
		var tiroVez = 0;
		var tempotiro = 0.3*fps; //1s = fps
		var tempotiroOrig = tempotiro;
		var numTirosBoss = 50;
		//imagem de www.spriters-resource.com
		/*---------------------------------------------------------------------------------------------------------------------*/
 		
 		/*SPRITE USADO PARA A CONSTUCAO DO TIRO BOSS*/
		function Sprite(){
			this.x = 110;
	 		this.y = 115;
			this.raio = 5;
	 		this.vy = 0;
	 		this.ay = 0;
			this.cor = 'lightgrey';
			this.energia = 100;
			this.vidas =3;
			this.atingido = 0; 
		}

		/*SPRITE USADO PARA A CONSTUCAO DO BOSS*/
		function SpriteBoss(){
			this.raio = 50;
			this.x = tela.width-this.raio;
	 		this.y = tela.height/2; 
	 		this.vx = -100;
	 		this.vy = 90; 
	 		this.ax = 0;
	 		this.ay = 0;  
			this.energia = 100; 
			this.atingido = 0;  
		}

		/*DEFINICAO GERAL DO MOVIMENTO DOS TIROS*/
		Sprite.prototype.mover = function (){
 			this.vx = this.vx + this.ax*dt;
 			this.x = this.x + this.vx*dt;
 			this.vy = this.vy + this.ay*dt;
 			this.y = this.y + this.vy*dt;  
 			if (this.x < -this.raio-10){ 
 				this.vx=0;
 			}
 			if (this.y <= -this.raio-10){
 				this.vx=0;;
 			}
 			if (this.y >= tela.height+this.raio){
 				this.vx=0;
 			}			
 		} 

 		/*MOVIMENTO DO BOSS*/
 		SpriteBoss.prototype.mover = function (){
 			this.vx = this.vx + this.ax*dt;
 			this.x = this.x + this.vx*dt;
 			this.vy = this.vy + this.ay*dt;
 			this.y = this.y + this.vy*dt;
 			if (this.x < 0){
 				this.x = tela.width+20;
 			}
 			if (this.y <= 45){
 				this.y = 45+this.raio;
 			}
 			if (this.y >= tela.height-this.raio){
 				this.y = tela.height - this.raio;
 			}
 		}

 		//FAZ COM QUE O BOSS ATIRE
 		SpriteBoss.prototype.atirar = function(){
 			for (var i = 0; i < numTirosBoss; i++) {
				if (tiros[i].vx == 0){ 
					tiros[i].y = boss.y;
					tiros[i].x = boss.x+20;
					tiros[i].raio=13;
					tiros[i].vx= -200;  
					console.log(i);
					break;
				}
			}
 		}

		//CRIA TIROS DO BOSS
		function criaTiroBoss(){
			var tiro  = new Sprite();
			tiro.raio = 20;
			tiro.x = -100;
			tiro.y = -100;
			tiro.vx = 0;
			tiro.ax = 0;
			tiro.y = 0;
			tiro.vy = 0;
			tiro.ay = 0;  
			return tiro;
		}

		//PREENCHE O VETOR DE TIROS DO BOSS
		for (var i = 0; i < numTirosBoss; i++) {
			tiros.push(criaTiroBoss()); 
		}
		
		desenhar = function(x,y,raio){
			ctx.drawImage(tiroB, x, y, raio, raio);
		}

		//DESENHA O BOSS
		boss.desenhar = function(){
			ctx.drawImage(imgBoss, this.x-this.raio , this.y-this.raio,this.raio*2,this.raio*2);
		}   
		boss.mover = function(){
			if(this.x < (700)|| this.x > (tela.width-this.raio)){
				this.vx = -this.vx;
			}
			if(this.y<this.raio || this.y > (tela.height-this.raio)){
				this.vy = -this.vy;
			}

			this.vx = (this.vx + this.ax*dt);
 			this.x = this.x + this.vx*dt;
 			this.vy = this.vy + this.ay*dt;
 			this.y = this.y + this.vy*dt; 
		} 
		//PASSO
		function passo(){  			
			ctx.clearRect(0,0,tela.width,tela.height);

			ctx.fillStyle = "rgb(50,50,50)";
			ctx.fillRect(700-boss.raio,0,tela.width,tela.height);


			boss.mover();
			boss.desenhar(); 
			if (tempotiro>0) {
				tempotiro--;
			}else{
				boss.atirar();
				tempotiro= tempotiroOrig;
			} 
			for (var i = 0; i <numTirosBoss; i++) {
				tiros[i].mover();
				desenhar(tiros[i].x-boss.raio-tiros[i].raio,tiros[i].y-10,tiros[i].raio);
			}
			tempotiro--;
		}
		setInterval(passo, 1000/fps);  

	</script>
</center>
	</body>
</html>